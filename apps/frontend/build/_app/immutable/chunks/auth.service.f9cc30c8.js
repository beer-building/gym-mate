import{u as S,n as O,p as L,a as U,b as W,v as X,c as j,y as Y,N as Z,x as c,$ as _,h as ee}from"./http-service.b939156e.js";var B=new Map,C=t=>([a],y)=>t(y,a),V=S();function te(t){var{adapter:a,store:y,source:i=y,target:k=y,clock:x=i,done:m,fail:g=V,finally:h,pickup:d,context:E,key:$,keyPrefix:l="",contract:p}=t;if(!a)throw Error("Adapter is not defined");if(!i)throw Error("Store or source is not defined");if(!k)throw Error("Target is not defined");if(!$&&i.shortName===i.id)throw Error("Key or name is not defined");if(i===k&&!O.store(i))throw Error("Source must be different from target");t.def===void 0&&O.store(i)&&(t.def=i.defaultState);var n="factory"in a?a(t):a,v=$||i.shortName,b=function(s,u){var o=B.get(s);o===void 0&&(o=new Map,B.set(s,o));var f=o.get(u);return f!==void 0||(f=L(null,{serialize:"ignore"}),o.set(u,f)),f}(n.keyArea||n,l+v),T=U(),I=()=>X(T),P=s=>({status:u="fail",params:o,result:f,error:w})=>u==="done"?{status:u,key:v,keyPrefix:l,operation:s,value:s==="get"?f:o}:{status:u,key:v,keyPrefix:l,operation:s,value:typeof o=="function"?void 0:o,error:w};return W(T,()=>{var s=L([],{serialize:"ignore"}),u=n(l+v,e=>K(e)),o=j({source:s,effect:C(u.get)}),f=j({source:s,effect:C(u.set)}),w=Y((e=>r=>!e||r===void 0||("isData"in e?e.isData(r):e(r))?r:(()=>{throw"getErrorMessages"in e?e.getErrorMessages(r):void 0})())(p)),A=S(),H=A.filterMap(({status:e,key:r,keyPrefix:D,operation:M,value:z})=>e==="done"?{key:r,keyPrefix:D,operation:M,value:z}:void 0),Q=A.filterMap(({status:e,key:r,keyPrefix:D,operation:M,error:z,value:R})=>e==="fail"?{key:r,keyPrefix:D,operation:M,error:z,value:R}:void 0),J=S(),K=o;s.updates.watch(()=>{K=(e=>{try{return Z(e,{safe:!0})}catch{return e}})(o)}),c({source:i,clock:x,target:J}),_({source:c(b,J,(e,r)=>[r,e]),filter:([e,r])=>e!==r,target:f.prepend(([e])=>e)}),c({clock:[o.doneData,f],target:b}),c({clock:[o.doneData,b],target:w}),c({clock:w.doneData,target:k}),c({clock:[o.finally.map(P("get")),f.finally.map(P("set")),w.fail.map(P("validate"))],target:A}),h&&c({clock:A,target:h}),m&&c({clock:H,target:m}),c({clock:Q,target:g}),E&&s.on(E,([e],r)=>[r===void 0?e:r]),d?(c({clock:d,fn:()=>{},target:o}),s.on(d,([e],r)=>[r===void 0?e:r])):o()}),I.unsubscribe=I}V.watch(t=>console.error(t.error));function q({keyArea:t=""}={}){var a=()=>({get(){},set(){}});return a.keyArea=t,a.noop=!0,a}q.factory=!0;function F({storage:t,sync:a=!1,serialize:y=JSON.stringify,deserialize:i=JSON.parse,timeout:k,def:x}){var m=(g,h)=>{var d,E,$,l=()=>$.setItem(g,y(E)),p=n=>{d=clearTimeout(d),n&&l(),typeof removeEventListener<"u"&&removeEventListener("beforeunload",p)};return a&&typeof addEventListener<"u"&&addEventListener("storage",n=>{n.storageArea===t()&&(n.key===g&&h(a==="force"?void 0:n.newValue),n.key===null&&h(null))}),{get(n){p();var v=n!==void 0?n:t().getItem(g);return v===null?x!==void 0?x:n:i(v)},set(n){E=n,$=t(),k===void 0?l():d||(d=setTimeout(p,k,1),typeof addEventListener<"u"&&addEventListener("beforeunload",p))}}};try{m.keyArea=t()}catch{}return m}F.factory=!0;function G(t){return function(){try{return typeof localStorage<"u"}catch{return!0}}()?F({storage:()=>localStorage,sync:!0,...t}):q({keyArea:"local"})}function re(t){return a=>te({adapter:G,...t,...a})}G.factory=!0;var oe=re();const N=L({token:""}),ie=N.map(({token:t})=>!!t.length),ae=S();c({clock:N,fn:({token:t})=>t,target:ee.setAuthCredentials()});oe({source:ae,target:N,key:"token"});export{ie as $,ae as s};
